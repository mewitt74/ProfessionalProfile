<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISO Control Set Analyzer</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1600px; margin: 0 auto; background: white; border-radius: 12px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); overflow: hidden; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 40px 30px; text-align: center; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; font-weight: 700; }
        .header p { font-size: 1.1em; opacity: 0.95; margin-bottom: 20px; }
        .content { padding: 30px; }
        .standard-selector { display: flex; gap: 10px; margin-bottom: 30px; flex-wrap: wrap; align-items: center; }
        .standard-btn { padding: 10px 18px; background: #f0f0f0; border: 2px solid #ddd; border-radius: 6px; cursor: pointer; font-size: 0.95em; font-weight: 500; transition: all 0.3s ease; color: #333; }
        .standard-btn:hover { background: #667eea; color: white; border-color: #667eea; }
        .standard-btn.active { background: #667eea; color: white; border-color: #667eea; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3); }
        .tabs { display: flex; gap: 10px; margin-bottom: 25px; border-bottom: 2px solid #e0e0e0; flex-wrap: wrap; }
        .tab-btn { padding: 12px 20px; background: none; border: none; border-bottom: 3px solid transparent; cursor: pointer; font-size: 1em; font-weight: 500; color: #666; transition: all 0.3s ease; }
        .tab-btn:hover { color: #667eea; }
        .tab-btn.active { color: #667eea; border-bottom-color: #667eea; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .search-filter { display: flex; gap: 15px; margin-bottom: 25px; flex-wrap: wrap; }
        .search-box { flex: 1; min-width: 250px; padding: 10px 15px; border: 2px solid #ddd; border-radius: 6px; font-size: 1em; }
        .search-box:focus { outline: none; border-color: #667eea; box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1); }
        .search-box:focus-visible, .standard-btn:focus-visible, .tab-btn:focus-visible, .filter-select:focus-visible { outline: 3px solid rgba(102,126,234,0.25); outline-offset: 2px; }
        .filter-select { padding: 10px 15px; border: 2px solid #ddd; border-radius: 6px; font-size: 1em; cursor: pointer; background: white; color: #333; }
        .filter-select:focus { outline: none; border-color: #667eea; }
        .control-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .control-card { background: white; border: 2px solid #e0e0e0; border-radius: 8px; padding: 20px; transition: all 0.3s ease; cursor: pointer; }
        .control-card:hover { border-color: #667eea; box-shadow: 0 8px 20px rgba(102, 126, 234, 0.15); transform: translateY(-4px); }
        .control-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px; }
        .control-id { background: #667eea; color: white; padding: 4px 10px; border-radius: 4px; font-weight: 600; font-size: 0.85em; }
        .control-category { background: #f0f0f0; color: #333; padding: 4px 10px; border-radius: 4px; font-size: 0.8em; font-weight: 500; }
        .control-category.organizational { background: #e8f4f8; color: #0277bd; }
        .control-category.people { background: #f3e5f5; color: #7b1fa2; }
        .control-category.physical { background: #fff3e0; color: #e65100; }
        .control-category.technological { background: #e8f5e9; color: #2e7d32; }
        .control-title { font-size: 1.1em; font-weight: 600; color: #333; margin-bottom: 10px; line-height: 1.4; }
        .control-description { font-size: 0.95em; color: #666; line-height: 1.5; margin-bottom: 12px; }
        .control-tags { display: flex; gap: 6px; flex-wrap: wrap; }
        .tag { background: #f0f0f0; color: #555; padding: 4px 8px; border-radius: 4px; font-size: 0.8em; }
        .table-wrapper { overflow-x: auto; border: 1px solid #e0e0e0; border-radius: 8px; margin-bottom: 30px; }
        table { width: 100%; border-collapse: collapse; min-width: 1000px; }
        th { background: #f5f5f5; padding: 15px; text-align: left; font-weight: 600; color: #333; border-bottom: 2px solid #ddd; }
        td { padding: 12px 15px; border-bottom: 1px solid #e0e0e0; color: #555; }
        tr:hover { background: #fafafa; }
        .requirement-box { background: #f9f9f9; border-left: 4px solid #667eea; padding: 15px; margin-bottom: 15px; border-radius: 4px; }
        .requirement-clause { font-weight: 600; color: #667eea; margin-bottom: 8px; font-size: 0.95em; }
        .requirement-title { font-weight: 600; color: #333; margin-bottom: 6px; font-size: 1em; }
        .requirement-text { color: #666; font-size: 0.95em; line-height: 1.6; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 30px; }
        .stat-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 8px; text-align: center; }
        .stat-number { font-size: 2.5em; font-weight: 700; margin-bottom: 8px; }
        .stat-label { font-size: 0.95em; opacity: 0.95; }
        .legend { display: flex; gap: 20px; margin-bottom: 25px; flex-wrap: wrap; padding: 20px; background: #f5f5f5; border-radius: 8px; }
        .legend-item { display: flex; align-items: center; gap: 8px; }
        .legend-box { width: 20px; height: 20px; border-radius: 4px; }
        .footer { background: #f5f5f5; padding: 20px 30px; text-align: center; color: #666; font-size: 0.9em; border-top: 1px solid #ddd; }
        .no-results { text-align: center; padding: 40px 20px; color: #999; }
        .section-title { font-size: 1.4em; font-weight: 700; color: #333; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px solid #667eea; }
        .overlap-section { background: #e3f2fd; border: 1px solid #90caf9; border-radius: 8px; padding: 20px; margin: 25px 0; }
        .overlap-section h3 { color: #1565c0; margin-bottom: 15px; font-size: 1.1em; }
        .overlap-item { background: white; border-left: 4px solid #42a5f5; padding: 12px 15px; margin-bottom: 12px; border-radius: 4px; }
        .overlap-control { font-weight: 600; color: #1565c0; margin-bottom: 6px; font-size: 0.95em; }
        .overlap-reference { color: #666; font-size: 0.9em; margin-bottom: 6px; }
        .overlap-reason { color: #555; font-size: 0.9em; font-style: italic; padding: 8px; background: #f5f5f5; border-radius: 3px; margin-top: 6px; }
    </style>
    </script>
</body>
</html>
                ]
            },
            "ISO 20000": {
                type: "IT Service Management",
                clauses: 8,
                processes: 13,
                description: "Establishes IT service management system aligned with ITIL framework covering 13 service management processes.",
                normativeRequirements: [
                    { clause: "4.1", title: "Understanding organization context", description: "Determine internal/external context relevant to IT services", mandatory: "Service context documentation" },
                    { clause: "6.1", title: "Service management planning", description: "Plan service management objectives and processes", mandatory: "Service management plan" },
                    { clause: "8.1", title: "Service management system operation", description: "Implement 13 service management processes from Annex A", mandatory: "Process documentation and records" },
                    { clause: "9.1", title: "Service monitoring", description: "Monitor service performance against SLAs", mandatory: "Service metrics and monitoring records" }
                ],
                stats: { totalControls: "13 Service Processes", totalClauses: "8 Clauses", framework: "ITIL-Aligned" },
                overlappingControls: [
                    { control: "7.2 (IT Service Competence)", overlaps: "ISO 9001:7.2, ISO 14001:7.2, ISO 45001:7.2, ISO 27001:A.6.3, ISO 42001:A.3.2, ISO 37001:8.10", reason: "ITIL module added to base competence and training program" },
                    { control: "8.2 (Change Management)", overlaps: "ISO 9001:8.1, ISO 27001:A.14.2.1, ISO 42001:A.11, ISO 37001:8.1, ISO 22301:8.3", reason: "Unified change control process with IT service considerations" },
                    { control: "9.1 (IT Service Monitoring)", overlaps: "ISO 9001:9.1, ISO 14001:9.1, ISO 45001:9.1, ISO 27001:A.12.4.1, ISO 42001:A.10.2, ISO 22301:9.1", reason: "Service metrics integrated into unified KPI dashboard" }
                ]
            },
            "ISO 22301": {
                type: "Business Continuity Management",
                clauses: 10,
                requirements: 8,
                description: "Establishes business continuity management system to ensure organizational resilience and minimize disruption from incidents.",
                normativeRequirements: [
                    { clause: "4.1", title: "Understanding organization context", description: "Identify internal/external business continuity context", mandatory: "Business context analysis" },
                    { clause: "6.1", title: "Business impact analysis", description: "Assess critical processes and disruption scenarios", mandatory: "BIA report and risk register" },
                    { clause: "6.2", title: "Continuity strategy", description: "Develop strategy to achieve recovery objectives", mandatory: "Strategy documentation" },
                    { clause: "8.1", title: "Operational planning", description: "Develop continuity plans and recovery procedures", mandatory: "BC plans and procedures" }
                ],
                stats: { totalControls: "8 Core Requirements", totalClauses: "10 Clauses", focus: "Business Resilience & Recovery" },
                overlappingControls: [
                    { control: "6.1 (Business Impact Analysis)", overlaps: "ISO 9001:6.1, ISO 14001:6.1, ISO 45001:6.1, ISO 27001:A.12.6.1, ISO 42001:A.6.1, ISO 37001:6.1", reason: "BIA integrated into unified risk assessment and treatment process" },
                    { control: "9.1 (Continuity Monitoring)", overlaps: "ISO 9001:9.1, ISO 14001:9.1, ISO 45001:9.1, ISO 27001:A.12.4.1, ISO 42001:A.10.2, ISO 20000:9.1", reason: "Continuity metrics included in unified monitoring dashboard" },
                    { control: "9.2 (Continuity Audit)", overlaps: "ISO 9001:9.2, ISO 14001:9.2, ISO 45001:9.2, ISO 27001:A.14.2, ISO 42001:9.2, ISO 37001:9.2", reason: "Continuity audit integrated into annual audit program" }
                ]
            },
            "ISO 37001": {
                type: "Anti-Bribery Management System",
                clauses: 10,
                requirements: 10,
                description: "Establishes anti-bribery management system to help organizations prevent, detect, and respond to bribery, comply with anti-bribery laws.",
                normativeRequirements: [
                    { clause: "4.1", title: "Understanding organization and context", description: "Determine internal/external context relevant to ABMS", mandatory: "Context analysis documentation" },
                    { clause: "4.2", title: "Understanding interested parties", description: "Determine interested parties and their anti-bribery requirements", mandatory: "Stakeholder analysis" },
                    { clause: "4.3", title: "Determining ABMS scope", description: "Define scope of anti-bribery management system", mandatory: "ABMS scope statement" },
                    { clause: "5.1", title: "Leadership commitment", description: "Top management demonstrates commitment to ABMS", mandatory: "Evidence of leadership commitment" },
                    { clause: "5.2", title: "Anti-bribery policy", description: "Establish, implement, communicate anti-bribery policy", mandatory: "Anti-bribery policy document" },
                    { clause: "6.1", title: "Actions to address risks", description: "Plan actions to address bribery risks and opportunities", mandatory: "Risk assessment and treatment plan" },
                    { clause: "8.1", title: "Operational planning", description: "Plan and control operations to manage bribery risks", mandatory: "Operational procedures" },
                    { clause: "8.2", title: "Due diligence", description: "Conduct due diligence on high-risk business associates", mandatory: "Due diligence records" },
                    { clause: "8.3", title: "Training and awareness", description: "Provide training on anti-bribery policies", mandatory: "Training records" },
                    { clause: "9.1", title: "Monitoring and evaluation", description: "Monitor ABMS effectiveness and performance", mandatory: "Monitoring records and metrics" }
                ],
                stats: { totalControls: "10 Requirements", totalClauses: "10 Clauses", focus: "Anti-Bribery & Compliance" },
                overlappingControls: [
                    { control: "5.2 (Anti-Bribery Policy)", overlaps: "ISO 9001:5.2, ISO 14001:5.2, ISO 45001:5.2, ISO 27001:A.5.1, ISO 42001:A.2.1, ISO 27701:5.1", reason: "Master policy includes anti-bribery and corruption prevention section" },
                    { control: "6.1 (Bribery Risk Assessment)", overlaps: "ISO 9001:6.1, ISO 14001:6.1, ISO 45001:6.1, ISO 27001:A.12.6.1, ISO 42001:A.6.1, ISO 22301:6.1", reason: "Corruption risks integrated into unified risk register with ABMS labels" },
                    { control: "8.10 (Anti-Bribery Training)", overlaps: "ISO 9001:7.2, ISO 14001:7.2, ISO 45001:7.2, ISO 27001:A.6.3, ISO 42001:A.3.2, ISO 20000:7.2", reason: "Anti-bribery module added to base training curriculum for all staff" },
                    { control: "9.1 (ABMS Monitoring)", overlaps: "ISO 9001:9.1, ISO 14001:9.1, ISO 45001:9.1, ISO 27001:A.12.4.1, ISO 42001:A.10.2, ISO 22301:9.1, ISO 20000:9.1", reason: "Compliance monitoring metrics included in unified dashboard" },
                    { control: "9.2 (ABMS Audit)", overlaps: "ISO 9001:9.2, ISO 14001:9.2, ISO 45001:9.2, ISO 27001:A.14.2, ISO 42001:9.2, ISO 22301:9.2", reason: "Anti-bribery audit integrated into annual audit program" }
                ]
            }
        };

        let currentStandard = "ISO 9001";
        let selectedStandards = new Set(['ISO 9001']);

        function selectStandard(standard) {
            selectedStandards.clear();
            selectedStandards.add(standard);
            currentStandard = standard;
            document.querySelectorAll('.standard-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            try { logEvent('select_standard', standard); } catch(e){}
            // Reset to overview tab
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('[onclick="switchTab(' + "'overview'" + ')"]').classList.add('active');
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.getElementById('overview').classList.add('active');
            renderOverview();
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            if (tabName === 'overview') renderOverview();
            else if (tabName === 'requirements') renderRequirements();
            else if (tabName === 'controls') renderControls();
            else if (tabName === 'comparison') renderComparison();
            else if (tabName === 'overlap-analysis') renderOverlapAnalysis();
            else if (tabName === 'generator') renderGenerator();
        }

        function renderOverview() {
            const data = standardsData[currentStandard];
            let html = `
                <h2 class="section-title">${currentStandard} Overview</h2>
                <p style="font-size: 1.05em; color: #666; margin-bottom: 20px; line-height: 1.6;">${data.description}</p>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">${data.clauses || 'N/A'}</div>
                        <div class="stat-label">Total Clauses</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${data.controls || data.requirements || data.processes || 'Custom'}</div>
                        <div class="stat-label">${data.controls ? 'Controls' : data.requirements ? 'Requirements' : 'Processes'}</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${data.type.split(' ')[0]}</div>
                        <div class="stat-label">Standard Type</div>
                    </div>
                </div>
                <h3 style="font-size: 1.2em; font-weight: 600; color: #333; margin: 30px 0 15px 0;">Standard Characteristics</h3>
                <div style="background: #f9f9f9; padding: 20px; border-radius: 8px; border-left: 4px solid #667eea;">
                    <p style="color: #666; font-size: 1em; line-height: 1.8;">
                        <strong>Type:</strong> ${data.type}<br>
                        <strong>Primary Focus:</strong> ${data.description.substring(0, 100)}...<br>
                        <strong>Scope:</strong> ${data.clauses} clauses covering context, leadership, planning, support, operations, and improvement
                    </p>
                </div>
            `;

            // Add overlap detection section if available
            if (data.overlappingControls) {
                html += `
                    <div class="overlap-section">
                        <h3>‚ö†Ô∏è Control Overlap Detection - Avoid Redundancy</h3>
                        <p style="color: #1565c0; margin-bottom: 15px; font-size: 0.95em;">These ${currentStandard} controls overlap with other standards, allowing you to implement once and satisfy multiple requirements.</p>
                `;
                data.overlappingControls.forEach(item => {
                    html += `
                        <div class="overlap-item">
                            <div class="overlap-control">${item.control}</div>
                            <div class="overlap-reference"><strong>Overlaps with:</strong> ${item.overlaps}</div>
                            <div class="overlap-reason"><strong>Strategy:</strong> ${item.reason}</div>
                        </div>
                    `;
                });
                html += `</div>`;
            }
            document.getElementById('overviewContent').innerHTML = html;
        }

        function renderRequirements() {
            const data = standardsData[currentStandard];
            if (!data || !data.normativeRequirements) {
                document.getElementById('requirementsContent').innerHTML = '<p class="no-results">No detailed requirements available</p>';
                return;
            }
            const query = (document.getElementById('requirementSearch') && document.getElementById('requirementSearch').value || '').trim().toLowerCase();
            let list = data.normativeRequirements.slice();
            if (query) {
                list = list.filter(req => {
                    const combined = `${req.clause} ${req.title} ${req.description} ${req.mandatory || ''}`.toLowerCase();
                    return combined.indexOf(query) !== -1;
                });
            }
            let html = '<h2 class="section-title">Normative Requirements</h2>';
            html += `<p style="color: #666; margin-bottom: 20px;">Total Requirements: <strong>${list.length}</strong>${query ? ` <span style="color:#999;">(filtered)</span>` : ''}</p>`;
            if (list.length === 0) {
                html += '<p class="no-results">No requirements match your search.</p>';
            } else {
                list.forEach((req, idx) => {
                    html += `
                    <div class="requirement-box">
                        <div class="requirement-clause">Clause ${req.clause}</div>
                        <div class="requirement-title">${req.title}</div>
                        <div class="requirement-text"><strong>Requirement:</strong> ${req.description}</div>
                        <div class="requirement-text"><strong>Mandatory Evidence:</strong> ${req.mandatory || '‚Äî'}</div>
                    </div>
                `;
                });
            }
            document.getElementById('requirementsContent').innerHTML = html;
        }

        function renderControls() {
            const data = standardsData[currentStandard];
            let html = '<h2 class="section-title">Control Sets</h2>';
            const query = (document.getElementById('controlSearch') && document.getElementById('controlSearch').value || '').trim().toLowerCase();
            const catFilter = (document.getElementById('categoryFilter') && document.getElementById('categoryFilter').value || '').trim().toLowerCase();

            if (data.controlCategories) {
                html += '<div class="legend">';
                Object.entries(data.controlCategories).forEach(([name, desc]) => {
                    const colorClass = name.toLowerCase().split(' ')[0];
                    html += ` <div class="legend-item"> <div class="legend-box ${colorClass}"></div> <span><strong>${name}:</strong> ${desc}</span> </div> `;
                });
                html += '</div>';
            }

            if (data.controlObjectives) {
                const items = Object.entries(data.controlObjectives).filter(([objective, desc]) => {
                    const combined = `${objective} ${desc}`.toLowerCase();
                    const matchesQuery = !query || combined.indexOf(query) !== -1;
                    const matchesCat = !catFilter || objective.toLowerCase().indexOf(catFilter) !== -1 || desc.toLowerCase().indexOf(catFilter) !== -1;
                    return matchesQuery && matchesCat;
                });
                if (items.length === 0) {
                    html += '<p class="no-results">No controls match your filters.</p>';
                } else {
                    html += '<div class="control-grid">';
                    items.forEach(([objective, desc]) => {
                        const controlName = objective.split(' (')[0];
                        html += `
                        <div class="control-card" onclick="showControlComparison('${controlName.replace(/'/g, "\\'")}')">
                            <div class="control-header">
                                <span class="control-id">${objective.split(' ')[0]}</span>
                                <span class="compare-btn" style="background: #667eea; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.75em; cursor: pointer; border: none;" onclick="event.stopPropagation(); showControlComparison('${controlName.replace(/'/g, "\\'")}')">‚áÑ Compare</span>
                            </div>
                            <div class="control-title">${objective}</div>
                            <div class="control-description">${desc}</div>
                        </div>
                    `;
                    });
                    html += '</div>';
                }
            } else if (data.controlCategories) {
                const items = Object.entries(data.controlCategories).filter(([category, desc]) => {
                    const combined = `${category} ${desc}`.toLowerCase();
                    const matchesQuery = !query || combined.indexOf(query) !== -1;
                    const matchesCat = !catFilter || category.toLowerCase().indexOf(catFilter) !== -1;
                    return matchesQuery && matchesCat;
                });
                if (items.length === 0) {
                    html += '<p class="no-results">No control categories match your filters.</p>';
                } else {
                    html += '<div class="control-grid">';
                    items.forEach(([category, desc]) => {
                        html += `
                        <div class="control-card" onclick="showControlComparison('${category.replace(/'/g, "\\'")}')">
                            <div class="control-header">
                                <span class="control-category">${category.split(' ')[0]}</span>
                                <span class="compare-btn" style="background: #667eea; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.75em; cursor: pointer; border: none;" onclick="event.stopPropagation(); showControlComparison('${category.replace(/'/g, "\\'")}')">‚áÑ Compare</span>
                            </div>
                            <div class="control-title">${category}</div>
                            <div class="control-description">${desc}</div>
                        </div>
                    `;
                    });
                    html += '</div>';
                }
            } else {
                html += '<p class="no-results">Detailed controls data not available</p>';
            }
            document.getElementById('controlsContent').innerHTML = html;
        }

        function selectAllStandards() {
            selectedStandards.clear();
            Object.keys(standardsData).forEach(standard => selectedStandards.add(standard));
            updateButtonStates();
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('[onclick="switchTab(' + "'comparison'" + ')"]').classList.add('active');
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.getElementById('comparison').classList.add('active');
            renderComparison();
        }

        function deselectAllStandards() {
            selectedStandards.clear();
            selectedStandards.add('ISO 9001');
            updateButtonStates();
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('[onclick="switchTab(' + "'overview'" + ')"]').classList.add('active');
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.getElementById('overview').classList.add('active');
            renderOverview();
        }

        function updateButtonStates() {
            document.querySelectorAll('.standard-btn').forEach(btn => {
                const text = btn.textContent.trim();
                if (selectedStandards.has(text)) { btn.classList.add('active'); } else { btn.classList.remove('active'); }
            });
        }

        function renderComparison() {
            let html = `
                <h2 class="section-title">Standard Comparison - ${selectedStandards.size} Standard(s) Selected</h2>
                <p style="color: #666; margin-bottom: 20px; font-size: 0.95em;"> <strong>Selected:</strong> ${Array.from(selectedStandards).sort().join(', ')} </p>
                <div class="table-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th>ISO Standard</th>
                                <th>Type</th>
                                <th>Clauses</th>
                                <th>Controls/Requirements</th>
                                <th>Primary Focus</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            Array.from(selectedStandards).sort().forEach(standard => {
                const info = standardsData[standard];
                html += `
                    <tr>
                        <td><strong>${standard}</strong></td>
                        <td>${info.type}</td>
                        <td>${info.clauses}</td>
                        <td>${info.controls || info.requirements || info.processes || 'N/A'}</td>
                        <td>${info.description.substring(0, 60)}...</td>
                    </tr>
                `;
            });
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            if (selectedStandards.size > 1) {
                html += `
                    <h3 style="font-size: 1.1em; font-weight: 600; color: #333; margin-top: 30px; margin-bottom: 20px;"> Integration & Overlap Summary </h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 15px;">
                        <div style="background: #e8f5e9; border-left: 4px solid #2e7d32; padding: 15px; border-radius: 4px;">
                            <strong style="color: #2e7d32;">üìã Policy Consolidation</strong>
                            <p style="font-size: 0.9em; color: #555; margin-top: 8px;">Create master policy with domain sections to satisfy all ${selectedStandards.size} standards simultaneously</p>
                        </div>
                        <div style="background: #e3f2fd; border-left: 4px solid #1565c0; padding: 15px; border-radius: 4px;">
                            <strong style="color: #1565c0;">üìä Unified Risk Register</strong>
                            <p style="font-size: 0.9em; color: #555; margin-top: 8px;">Single risk register with multi-label categorization reduces duplication by ~40%</p>
                        </div>
                        <div style="background: #fff3e0; border-left: 4px solid #e65100; padding: 15px; border-radius: 4px;">
                            <strong style="color: #e65100;">üë• Integrated Training</strong>
                            <p style="font-size: 0.9em; color: #555; margin-top: 8px;">Base training + role-specific modules covers all standards with 30-50% time savings</p>
                        </div>
                        <div style="background: #f3e5f5; border-left: 4px solid #7b1fa2; padding: 15px; border-radius: 4px;">
                            <strong style="color: #7b1fa2;">‚úì Single Audit Program</strong>
                            <p style="font-size: 0.9em; color: #555; margin-top: 8px;">Integrated annual audits cover all standards; one evidence library serves all</p>
                        </div>
                    </div>
                `;
            }
            document.getElementById('comparisonContent').innerHTML = html;
        }

        // Generator Data & Functions
        function renderGenerator() {
            let html = `
                <h2 class="section-title">ISO Control Overlap Generator</h2>
                <p style="color: #666; margin-bottom: 20px; font-size: 0.95em;"> Generate comprehensive implementation artifacts based on selected standards. Choose output type and download scalable comparison outputs. </p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div style="border: 2px solid #667eea; border-radius: 8px; padding: 20px; cursor: pointer; transition: all 0.3s;" onclick="generateOutput('policy-overlap')">
                        <h3 style="color: #667eea; margin: 0 0 12px 0; font-size: 1.1em;">üìã Policy Overlap Map</h3>
                        <p style="color: #666; margin: 0; font-size: 0.9em;">Master policy sections showing which controls from each standard are satisfied simultaneously</p>
                        <p style="color: #999; margin: 8px 0 0 0; font-size: 0.85em;">üìä Spreadsheet | Diagram | Policy Template</p>
                    </div>
                    <div style="border: 2px solid #2e7d32; border-radius: 8px; padding: 20px; cursor: pointer; transition: all 0.3s;" onclick="generateOutput('risk-tenancy')">
                        <h3 style="color: #2e7d32; margin: 0 0 12px 0; font-size: 1.1em;">üìä Risk Tenancy Matrix</h3>
                        <p style="color: #666; margin: 0; font-size: 0.9em;">Unified risk register with multi-label categorization across all selected standards</p>
                        <p style="color: #999; margin: 8px 0 0 0; font-size: 0.85em;">üìä Spreadsheet | Heat Map | Risk Register Template</p>
                    </div>
                    <div style="border: 2px solid #1565c0; border-radius: 8px; padding: 20px; cursor: pointer; transition: all 0.3s;" onclick="generateOutput('training-modules')">
                        <h3 style="color: #1565c0; margin: 0 0 12px 0; font-size: 1.1em;">üë• Training Modules</h3>
                        <p style="color: #666; margin: 0; font-size: 0.9em;">Base training + role-specific modules covering all standards with effort estimates</p>
                        <p style="color: #999; margin: 8px 0 0 0; font-size: 0.85em;">üìä Spreadsheet | Training Plan | Curriculum Map</p>
                    </div>
                    <div style="border: 2px solid #e65100; border-radius: 8px; padding: 20px; cursor: pointer; transition: all 0.3s;" onclick="generateOutput('implementation-roadmap')">
                        <h3 style="color: #e65100; margin: 0 0 12px 0; font-size: 1.1em;">üó∫Ô∏è Implementation Roadmap</h3>
                        <p style="color: #666; margin: 0; font-size: 0.9em;">Phased implementation timeline with milestones, dependencies, and effort estimates</p>
                        <p style="color: #999; margin: 8px 0 0 0; font-size: 0.85em;">üìä Spreadsheet | Gantt Chart | Roadmap Document</p>
                    </div>
                    <div style="border: 2px solid #7b1fa2; border-radius: 8px; padding: 20px; cursor: pointer; transition: all 0.3s;" onclick="generateOutput('audit-program')">
                        <h3 style="color: #7b1fa2; margin: 0 0 12px 0; font-size: 1.1em;">‚úì Audit Program</h3>
                        <p style="color: #666; margin: 0; font-size: 0.9em;">Integrated annual audit schedule with checklist and cross-reference matrix</p>
                        <p style="color: #999; margin: 8px 0 0 0; font-size: 0.85em;">üìä Spreadsheet | Audit Schedule | Evidence Library</p>
                    </div>
                    <div style="border: 2px solid #f57c00; border-radius: 8px; padding: 20px; cursor: pointer; transition: all 0.3s;" onclick="generateOutput('comparison-report')">
                        <h3 style="color: #f57c00; margin: 0 0 12px 0; font-size: 1.1em;">üìÑ Comparison Report</h3>
                        <p style="color: #666; margin: 0; font-size: 0.9em;">Complete analysis with overlap detection, effort savings, and integration strategies</p>
                        <p style="color: #999; margin: 8px 0 0 0; font-size: 0.85em;">üìÑ PDF Report | Word Document | HTML</p>
                    </div>
                </div>
                <div style="background: #e3f2fd; border-left: 4px solid #1565c0; padding: 20px; border-radius: 8px; margin-top: 30px;">
                    <h3 style="color: #1565c0; margin: 0 0 15px 0;">üîß Generator Status</h3>
                    <p style="color: #555; margin: 0;">
                        <strong>Selected Standards:</strong> ${Array.from(selectedStandards).sort().join(', ')}<br>
                        <strong>Total Standards:</strong> ${selectedStandards.size}<br>
                        <strong>Overlapping Controls Found:</strong> ${calculateOverlapCount()}<br>
                        <strong>Estimated Effort Savings:</strong> ~45% vs. separate implementations
                    </p>
                </div>
            `;
            document.getElementById('generatorContent').innerHTML = html;
        }

        function calculateOverlapCount() {
            let count = 0;
            selectedStandards.forEach(standard => {
                if (standardsData[standard].overlappingControls) { count += standardsData[standard].overlappingControls.length; }
            });
            return count;
        }

        function generateOutput(type) {
            let content = '';
            let filename = '';
            if (type === 'policy-overlap') { content = generatePolicyOverlap(); filename = 'ISO_Policy_Overlap_Map.csv'; }
            else if (type === 'risk-tenancy') { content = generateRiskTenancy(); filename = 'ISO_Risk_Tenancy_Matrix.csv'; }
            else if (type === 'training-modules') { content = generateTrainingModules(); filename = 'ISO_Training_Modules.csv'; }
            else if (type === 'implementation-roadmap') { content = generateImplementationRoadmap(); filename = 'ISO_Implementation_Roadmap.csv'; }
            else if (type === 'audit-program') { content = generateAuditProgram(); filename = 'ISO_Audit_Program.csv'; }
            else if (type === 'comparison-report') { content = generateComparisonReport(); filename = 'ISO_Comparison_Report.txt'; }
            downloadFile(content, filename);
        }

        function generatePolicyOverlap() {
            let csv = 'Policy Section,Control IDs,Standards Affected,Effort Savings\n';
            csv += 'Quality Management,ISO 9001:5.2,7 standards,~50%\n';
            csv += 'Information Security,ISO 27001:A.5.1,7 standards,~50%\n';
            csv += 'Environmental Management,ISO 14001:5.2,6 standards,~50%\n';
            csv += 'Occupational Health & Safety,ISO 45001:5.2,6 standards,~50%\n';
            csv += 'AI Ethics & Governance,ISO 42001:A.2.1,5 standards,~45%\n';
            csv += 'Privacy & Data Protection,ISO 27701:5.1,6 standards,~50%\n';
            csv += 'Anti-Bribery & Compliance,ISO 37001:5.2,6 standards,~50%\n';
            return csv;
        }

        function generateRiskTenancy() {
            let csv = 'Risk Category,Risk Type,Standards [Quality][Security][Environment][OHS][AI][Continuity][Anti-Bribery],Effort Savings\n';
            csv += 'Strategic,Market/Competitive,[X][X][][][][],30%\n';
            csv += 'Operational,Process Failure,[X][][X][X][][][],40%\n';
            csv += 'Compliance,Regulatory,[X][X][X][X][X][][],45%\n';
            csv += 'Security,Cyber Threat,[][X][][][][],35%\n';
            csv += 'Environmental,Pollution Impact,[][][][X][][],40%\n';
            csv += 'Safety,Workplace Injury,[][][X][][][],40%\n';
            csv += 'Reputational,Bribery/Corruption,[][][][][][][X],40%\n';
            return csv;
        }

        function generateTrainingModules() {
            let csv = 'Module,Target Audience,Duration,Standards Covered,Effort Hours\n';
            csv += 'Base Foundation,All Staff,2 hours,"All 9 standards",4 hours/person\n';
            csv += 'Quality Module,Quality Team,1.5 hours,ISO 9001,3 hours/person\n';
            csv += 'Security Module,IT/Security,2 hours,"ISO 27001, 27701",4 hours/person\n';
            csv += 'AI Module,AI Teams,2 hours,ISO 42001,4 hours/person\n';
            csv += 'Environmental Module,Operations,1.5 hours,ISO 14001,3 hours/person\n';
            csv += 'OHS Module,Safety Officers,2 hours,ISO 45001,4 hours/person\n';
            csv += 'Compliance Module,Management,1.5 hours,"ISO 37001, 22301",3 hours/person\n';
            return csv;
        }

        function generateImplementationRoadmap() {
            let csv = 'Phase,Timeline,Deliverable,Standards,Dependencies,Effort (Person-Days)\n';
            csv += 'Phase 1: Foundation,Months 1-2,Master Policy & Risk Register,"All 9",Leadership alignment,20\n';
            csv += 'Phase 2: Training,Months 2-3,Training Program Rollout,"All 9",Foundation phase,15\n';
            csv += 'Phase 3: Operational Setup,Months 3-5,Process Documentation & Controls,"All 9",Training complete,35\n';
            csv += 'Phase 4: Monitoring,Months 5-6,Dashboard & Metrics,"All 9",Operational setup,15\n';
            csv += 'Phase 5: Audit Readiness,Months 6-7,Internal Audit Program,"All 9",Monitoring active,10\n';
            csv += 'Phase 6: Certification,Months 7-9,External Audits,"All 9",Internal audits passed,20\n';
            return csv;
        }

        function generateAuditProgram() {
            let csv = 'Control Area,Audit Frequency,Standards Covered,Evidence Required,Audit Duration,Resource\n';
            csv += 'Policy & Strategy,Annual,All 9,Policy documents + communications,2 days,1 auditor\n';
            csv += 'Risk Assessment,Semi-Annual,"9001,27001,42001,37001,14001,45001",Risk register + treatment plan,3 days,2 auditors\n';
            csv += 'Training & Competence,Annual,"All 7 standards",Training records + competency assessment,2 days,1 auditor\n';
            csv += 'Operational Controls,Quarterly,Varies,Process documentation + execution records,5 days,2 auditors\n';
            csv += 'Monitoring & Metrics,Monthly,All 9,KPI dashboards + monitoring records,1 day,1 auditor\n';
            csv += 'Non-Conformity Management,Quarterly,All 9,CAPA records + closure evidence,2 days,1 auditor\n';
            return csv;
        }

        function generateComparisonReport() {
            let report = 'ISO CONTROL OVERLAP ANALYSIS REPORT\n\n';
            report += 'Executive Summary\n';
            report += '================\n';
            report += 'Selected Standards: ' + Array.from(selectedStandards).sort().join(', ') + '\n';
            report += 'Total Overlapping Controls: ' + calculateOverlapCount() + '\n';
            report += 'Estimated Effort Savings: ~45%\n\n';
            report += 'Key Findings\n';
            report += '============\n';
            report += '1. Policy Consolidation: 7 standards can be satisfied with ONE master policy\n';
            report += '2. Risk Management: Single unified risk register serves all standards (~50% effort reduction)\n';
            report += '3. Training Efficiency: Modular approach reduces training hours by 30-50%\n';
            report += '4. Audit Integration: Annual integrated audit vs. 9 separate audits (~50% time savings)\n';
            report += '5. System Consolidation: 1 system vs. 7+ separate systems (50%+ cost reduction)\n\n';
            report += 'Control Overlap Analysis\n';
            report += '=======================\n';
            selectedStandards.forEach(standard => {
                const data = standardsData[standard];
                if (data.overlappingControls) {
                    report += '\n' + standard + ':\n';
                    data.overlappingControls.forEach(item => {
                        report += ' - ' + item.control + ': Overlaps with ' + item.overlaps + '\n';
                    });
                }
            });
            return report;
        }

        function downloadFile(content, filename) {
            const element = document.createElement('a');
            try { logEvent('download_output', filename); } catch(e){}
            element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(content));
            element.setAttribute('download', filename);
            element.style.display = 'none';
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
            alert('‚úì ' + filename + ' downloaded successfully!\nNote: For Excel files, import CSV into your spreadsheet application.');
        }

        // Control Comparison Data Structure
        const controlComparisonData = {
            "Policy Establishment": [
                { standard: "ISO 9001", clause: "5.2", title: "Quality policy", description: "Establish and communicate quality policy", evidence: "Quality policy document", scope: "Quality Management" },
                { standard: "ISO 14001", clause: "5.2", title: "Environmental policy", description: "Establish and communicate environmental policy", evidence: "Environmental policy document", scope: "Environmental Management" },
                { standard: "ISO 45001", clause: "5.2", title: "OHS policy", description: "Establish and communicate OHS policy", evidence: "OHS policy document", scope: "Occupational Health & Safety" },
                { standard: "ISO 27001", clause: "A.5.1", title: "Information security policy", description: "Establish and communicate security policy", evidence: "Security policy document", scope: "Information Security" },
                { standard: "ISO 42001", clause: "A.2.1", title: "AI ethical use policy", description: "Establish AI governance and ethical use policy", evidence: "AI policy document", scope: "AI Management" },
                { standard: "ISO 37001", clause: "5.2", title: "Anti-bribery policy", description: "Establish and communicate anti-bribery policy", evidence: "Anti-bribery policy document", scope: "Anti-Bribery Compliance" }
            ],
            "Risk Assessment": [
                { standard: "ISO 9001", clause: "6.1", title: "Actions to address risks", description: "Plan actions to address risks and opportunities", evidence: "Risk assessment documentation", scope: "Quality Risk" },
                { standard: "ISO 27001", clause: "A.12.6.1", title: "Information security risk assessment", description: "Establish assessment process for security risks", evidence: "Risk register and treatment plan", scope: "Security Risk" },
                { standard: "ISO 42001", clause: "A.6.1", title: "AI risk assessment", description: "Perform AI-specific risk assessment and treatment", evidence: "AI risk assessment document", scope: "AI Risk" },
                { standard: "ISO 14001", clause: "6.1", title: "Environmental aspects and impacts", description: "Identify aspects and assess legal requirements", evidence: "Environmental aspects register", scope: "Environmental Risk" },
                { standard: "ISO 45001", clause: "6.1", title: "Hazard identification and risk assessment", description: "Identify hazards and assess/eliminate risks", evidence: "Hazard register and risk matrix", scope: "OHS Risk" },
                { standard: "ISO 37001", clause: "6.1", title: "Bribery risk assessment", description: "Identify and assess bribery-related risks", evidence: "Bribery risk assessment", scope: "Corruption Risk" }
            ],
            "Training & Competence": [
                { standard: "ISO 9001", clause: "7.2", title: "Competence", description: "Ensure personnel have required competence", evidence: "Training records and competency assessment", scope: "Quality Training" },
                { standard: "ISO 14001", clause: "7.2", title: "Environmental competence", description: "Ensure competence for environmental management", evidence: "Environmental training records", scope: "Environmental Training" },
                { standard: "ISO 45001", clause: "7.2", title: "OHS competence", description: "Ensure competence for OHS management", evidence: "OHS training and competency records", scope: "Safety Training" },
                { standard: "ISO 27001", clause: "A.6.3", title: "User awareness and training", description: "Provide security awareness training", evidence: "Training records and assessment results", scope: "Security Training" },
                { standard: "ISO 42001", clause: "A.3.2", title: "AI competence", description: "Ensure AI-related role competence", evidence: "AI training records and skill assessments", scope: "AI Training" },
                { standard: "ISO 37001", clause: "8.10", title: "Training on anti-bribery", description: "Provide anti-bribery awareness training", evidence: "Training records and attendance", scope: "Compliance Training" }
            ],
            "Monitoring & Measurement": [
                { standard: "ISO 9001", clause: "9.1", title: "Monitoring and measurement", description: "Monitor quality KPIs and processes", evidence: "Monitoring records and metrics", scope: "Quality Metrics" },
                { standard: "ISO 14001", clause: "9.1", title: "Environmental monitoring", description: "Monitor environmental KPIs and performance", evidence: "Environmental monitoring records", scope: "Environmental Metrics" },
                { standard: "ISO 45001", clause: "9.1", title: "OHS monitoring and measurement", description: "Monitor OHS metrics and incidents", evidence: "OHS monitoring and incident records", scope: "Safety Metrics" },
                { standard: "ISO 27001", clause: "A.12.4.1", title: "Security event logging", description: "Monitor and log security events", evidence: "Log files and monitoring records", scope: "Security Monitoring" },
                { standard: "ISO 42001", clause: "A.10.2", title: "AI model performance monitoring", description: "Monitor model drift and performance", evidence: "Performance metrics and monitoring logs", scope: "AI Performance" },
                { standard: "ISO 22301", clause: "9.1", title: "Continuity monitoring", description: "Monitor business continuity readiness", evidence: "Continuity metrics and test results", scope: "Continuity Metrics" }
            ],
            "Internal Audit": [
                { standard: "ISO 9001", clause: "9.2", title: "Internal audit", description: "Conduct periodic quality audits", evidence: "Audit schedule and findings report", scope: "Quality Audit" },
                { standard: "ISO 14001", clause: "9.2", title: "Environmental internal audit", description: "Conduct periodic environmental audits", evidence: "Audit schedule and findings report", scope: "Environmental Audit" },
                { standard: "ISO 45001", clause: "9.2", title: "OHS internal audit", description: "Conduct periodic OHS audits", evidence: "Audit schedule and findings report", scope: "OHS Audit" },
                { standard: "ISO 27001", clause: "A.14.2", title: "Internal audit", description: "Conduct periodic security audits", evidence: "Audit schedule and findings report", scope: "Security Audit" },
                { standard: "ISO 42001", clause: "9.2", title: "AI system audit", description: "Audit AI systems and controls", evidence: "Audit findings and corrective actions", scope: "AI Audit" },
                { standard: "ISO 37001", clause: "9.2", title: "ABMS internal audit", description: "Conduct periodic anti-bribery audits", evidence: "Audit schedule and findings report", scope: "Compliance Audit" }
            ]
        };

        function showControlComparison(controlName) {
            try { logEvent('compare_control', controlName); } catch(e){}
            const comparisonData = controlComparisonData[controlName];
            if (!comparisonData) { alert('Comparison data not available for this control'); return; }
            
            // Build table rows
            let tableRows = '';
            comparisonData.forEach(row => {
                tableRows += `<tr>
                    <td style="font-weight: 600; color: #667eea;">${row.standard}</td>
                    <td style="font-family: monospace; font-weight: 600;">${row.clause}</td>
                    <td style="font-weight: 500;">${row.title}</td>
                    <td style="font-size: 0.9em; line-height: 1.5;">${row.description}</td>
                    <td style="font-size: 0.9em; color: #666;">${row.evidence}</td>
                </tr>`;
            });
            
            // Build complete modal HTML
            let html = `
                <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); display: flex; align-items: center; justify-content: center; z-index: 10000;" onclick="closeComparison()">
                    <div style="background: white; border-radius: 12px; max-width: 95vw; max-height: 90vh; overflow-y: auto; padding: 0; box-shadow: 0 25px 50px rgba(0,0,0,0.3);" onclick="event.stopPropagation()">
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0;">
                            <div>
                                <h2 style="margin: 0 0 5px 0; font-size: 1.5em;">‚áÑ Control Comparison: ${controlName}</h2>
                                <p style="margin: 0; opacity: 0.9; font-size: 0.95em;">Implementation across ${comparisonData.length} ISO standards</p>
                            </div>
                            <button onclick="closeComparison()" style="background: rgba(255,255,255,0.3); border: none; color: white; font-size: 1.5em; cursor: pointer; width: 40px; height: 40px; border-radius: 6px;">‚úï</button>
                        </div>
                        <div style="padding: 25px;">
                            <div class="table-wrapper">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>ISO Standard</th>
                                            <th>Clause</th>
                                            <th>Control Title</th>
                                            <th>Description</th>
                                            <th>Evidence Required</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${tableRows}
                                    </tbody>
                                </table>
                            </div>
                            <div style="margin-top: 25px; padding: 20px; background: #f5f5f5; border-radius: 8px; border-left: 4px solid #667eea;">
                                <h3 style="margin: 0 0 12px 0; color: #333; font-size: 1.05em;">üí° Implementation Strategy</h3>
                                <p style="margin: 0; color: #555; font-size: 0.95em; line-height: 1.6;">This control can be implemented once using a unified approach to satisfy all ${comparisonData.length} standards simultaneously. Create a single process/policy/procedure that addresses the unique scope requirements of each standard, then map evidence to all standards. Estimated effort savings: <strong>40-50%</strong> vs. separate implementations.</p>
                            </div>
                            <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
                                <button onclick="downloadControlComparison('${controlName.replace(/'/g, "\\'")}', ${comparisonData.length})" style="padding: 10px 18px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 500;">‚¨á Download Comparison</button>
                                <button onclick="closeComparison()" style="padding: 10px 18px; background: #ddd; color: #333; border: none; border-radius: 6px; cursor: pointer; font-weight: 500;">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            const modal = document.createElement('div');
            modal.id = 'comparisonModal';
            modal.innerHTML = html;
            document.body.appendChild(modal);
        }

        function closeComparison() { const modal = document.getElementById('comparisonModal'); if (modal) modal.remove(); }

        function downloadControlComparison(controlName, standardCount) {
            const comparisonData = controlComparisonData[controlName];
            if (!comparisonData) return;
            try { logEvent('download_control_comparison', controlName); } catch(e) {}
            let csv = 'Control Comparison: ' + controlName + '\n\n';
            csv += 'ISO Standard,Clause,Control Title,Description,Evidence Required\n';
            comparisonData.forEach(row => {
                const desc = '"' + row.description.replace(/"/g, '""') + '"';
                const evidence = '"' + row.evidence.replace(/"/g, '""') + '"';
                csv += `${row.standard},${row.clause},"${row.title}",${desc},${evidence}\n`;
            });
            csv += '\n\nImplementation Strategy\n';
            csv += 'This control satisfies ' + standardCount + ' ISO standards with a unified implementation approach.\n';
            csv += 'Single policy/process/procedure can address all standards with ~40-50% effort savings.\n';
            const element = document.createElement('a');
            element.setAttribute('href', 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv));
            element.setAttribute('download', 'Control_Comparison_' + controlName.replace(/\s+/g, '_') + '.csv');
            element.style.display = 'none';
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
        }

        // Control Overlap Data
        const controlOverlapData = {
            "Policy Establishment": { category: "Foundational Controls", overlap_level: "VERY HIGH", controls: ["ISO 9001:5.2 (Quality)", "ISO 14001:5.2 (Environment)", "ISO 45001:5.2 (OHS)", "ISO 27001:A.5.1 (Security)", "ISO 42001:A.2.1 (AI)", "ISO 37001:5.2 (Anti-Bribery)", "ISO 27701:5.1 (Privacy)"], strategy: "Create ONE master policy with 7 sections. All standards met with single policy artifact + communications plan.", implementation: "Effort Savings: ~50%" },
            "Risk Assessment": { category: "Foundational Controls", overlap_level: "VERY HIGH", controls: ["ISO 9001:6.1 (Quality Risk)", "ISO 14001:6.1 (Environmental Risk)", "ISO 45001:6.1 (Hazard Risk)", "ISO 27001:A.12.6.1 (Security Risk)", "ISO 42001:A.6.1 (AI Risk)", "ISO 37001:6.1 (Bribery Risk)", "ISO 22301:6.1 (Business Impact)"], strategy: "Unified risk register with multi-label categorization [Quality][Security][Environment][OHS][AI][Anti-Bribery][Continuity]. Single assessment process.", implementation: "Effort Savings: ~50% | Combined register eliminates duplication" },
            "Training & Competence": { category: "People Management", overlap_level: "VERY HIGH", controls: ["ISO 9001:7.2 (QMS Training)", "ISO 14001:7.2 (Environmental Training)", "ISO 45001:7.2 (OHS Training)", "ISO 27001:A.6.3 (Security Training)", "ISO 42001:A.3.2 (AI Training)", "ISO 37001:8.10 (Anti-Bribery Training)", "ISO 20000:7.2 (ITIL Training)"], strategy: "Modular training: Base module (100+ staff) + 4-5 role-specific modules (Security, AI, Operations, Compliance, Leadership).", implementation: "Effort Savings: ~40% | Estimated training hours reduced by 30-50%" },
            "Monitoring & Measurement": { category: "Performance Management", overlap_level: "HIGH", controls: ["ISO 9001:9.1 (Quality KPIs)", "ISO 14001:9.1 (Environmental KPIs)", "ISO 45001:9.1 (OHS Metrics)", "ISO 27001:A.12.4.1 (Security Logging)", "ISO 42001:A.10.2 (AI Performance)", "ISO 22301:9.1 (Continuity Metrics)", "ISO 20000:9.1 (Service Metrics)"], strategy: "Unified dashboard with KPIs across all standards. Single data warehouse; multiple visualization layers. Automated alerts.", implementation: "Effort Savings: ~40% | Real-time cross-standard visibility" },
            "Internal Audit": { category: "Governance & Control", overlap_level: "VERY HIGH", controls: ["ISO 9001:9.2 (QMS Audit)", "ISO 14001:9.2 (Environmental Audit)", "ISO 45001:9.2 (OHS Audit)", "ISO 27001:A.14.2 (Security Audit)", "ISO 42001:9.2 (AI Audit)", "ISO 37001:9.2 (ABMS Audit)", "ISO 22301:9.2 (BC Audit)"], strategy: "Integrated annual audit program covering all 7 standards. Single checklist with cross-reference matrix. ONE evidence library.", implementation: "Effort Savings: ~50% | Audit duration: 4-6 weeks vs. 10-12 weeks separately" },
            "Authorization & Approval": { category: "Decision Making", overlap_level: "HIGH", controls: ["ISO 9001:8.1 (Process Approval)", "ISO 14001:8.1 (Environmental Control)", "ISO 45001:8.1 (OHS Control)", "ISO 27001:A.9.1 (Access Control)", "ISO 42001:A.9.1 (AI Oversight)", "ISO 37001:8.5 (Transaction Approval)", "ISO 20000:8.1 (Change Approval)"], strategy: "Unified approval workflow with role-based access controls. Single system routes to relevant approvers per standard.", implementation: "Effort Savings: ~45% | Automated approval routing reduces manual effort" },
            "Document & Record Management": { category: "Information Management", overlap_level: "HIGH", controls: ["ISO 9001:7.5 (Document Control)", "ISO 14001:7.5 (Environmental Documents)", "ISO 45001:7.5 (OHS Records)", "ISO 27001:A.8.2 (Information Classification)", "ISO 42001:A.5.1 (AI Documentation)", "ISO 37001:8.1 (ABMS Records)", "ISO 27701:A.1.1 (PII Records)"], strategy: "Single DMS with classification taxonomy covering all standards. Automated retention/disposal policies per standard.", implementation: "Effort Savings: ~40% | Unified evidence library supports all standards" },
            "Change Management": { category: "Operational Control", overlap_level: "MEDIUM-HIGH", controls: ["ISO 9001:8.5 (External Process Control)", "ISO 14001:8.1 (Environmental Change)", "ISO 27001:A.14.2.1 (Security Change)", "ISO 42001:A.11 (AI Model Change)", "ISO 37001:8.1 (Risk Reassessment)", "ISO 20000:8.2 (Change Management)", "ISO 22301:8.3 (Continuity Updates)"], strategy: "Standardized change control with multi-impact assessment. Single CAB evaluates Quality, Security, AI, OHS, Environment, Continuity impacts simultaneously.", implementation: "Effort Savings: ~35% | Single CAB vs. multiple review boards" }
        };

        function renderOverlapAnalysis() {
            let html = `
                <h2 class="section-title">Cross-Standard Control Overlap Analysis</h2>
                <p style="color: #666; margin-bottom: 10px; font-size: 0.95em;">This analysis identifies control families that serve multiple ISO standards simultaneously, helping you avoid redundant implementations and maximize efficiency.</p>
                <div style="background: #fff3e0; border-left: 4px solid #e65100; padding: 15px; margin-bottom: 25px; border-radius: 4px;">
                    <strong style="color: #e65100;">üí° Key Insight:</strong> Implementing these overlapping controls once satisfies 5-7 standards simultaneously, reducing total implementation effort by 40-50%.
                </div>
            `;
            Object.entries(controlOverlapData).forEach(([overlapName, data]) => {
                const colorClass = data.overlap_level === 'VERY HIGH' ? '#2e7d32' : data.overlap_level === 'HIGH' ? '#1565c0' : '#f57c00';
                const emoji = data.overlap_level === 'VERY HIGH' ? 'üî¥' : data.overlap_level === 'HIGH' ? 'üü†' : 'üü°';
                html += `
                    <div style="margin-bottom: 25px; border: 2px solid ${colorClass}; border-radius: 8px; overflow: hidden;">
                        <div style="background: ${colorClass}; color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h3 style="margin: 0; font-size: 1.15em;">${emoji} ${overlapName}</h3>
                                <p style="margin: 5px 0 0 0; font-size: 0.85em; opacity: 0.9;">${data.category}</p>
                            </div>
                            <span style="background: rgba(255,255,255,0.3); padding: 8px 15px; border-radius: 20px; font-weight: 600; font-size: 0.9em;"> ${data.overlap_level} </span>
                        </div>
                        <div style="padding: 20px; background: white;">
                            <div style="margin-bottom: 15px;">
                                <strong style="color: #333; display: block; margin-bottom: 8px;">Standards Affected (${data.controls.length}):</strong>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 8px;">
                `;
                data.controls.forEach(control => { html += `<div style="background: #f5f5f5; padding: 8px 12px; border-radius: 4px; font-size: 0.9em; color: #555;">‚úì ${control}</div>`; });
                html += `
                                </div>
                            </div>
                            <div style="margin-bottom: 15px; padding: 12px; background: #e3f2fd; border-radius: 4px; border-left: 4px solid #1565c0;">
                                <strong style="color: #1565c0; display: block; margin-bottom: 6px;">üìã Integration Strategy:</strong>
                                <p style="margin: 0; color: #555; font-size: 0.95em;">${data.strategy}</p>
                            </div>
                            <div style="padding: 12px; background: #e8f5e9; border-radius: 4px; border-left: 4px solid #2e7d32;">
                                <strong style="color: #2e7d32; display: block; margin-bottom: 6px;">‚úì Implementation Benefit:</strong>
                                <p style="margin: 0; color: #555; font-size: 0.95em;">${data.implementation}</p>
                            </div>
                        </div>
                    </div>
                `;
            });
            html += `
                <h3 style="font-size: 1.1em; font-weight: 600; color: #333; margin-top: 40px; margin-bottom: 20px;"> üìä Implementation Efficiency Summary </h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                    <div style="background: linear-gradient(135deg, #2e7d32 0%, #1b5e20 100%); color: white; padding: 20px; border-radius: 8px;">
                        <div style="font-size: 2em; font-weight: 700; margin-bottom: 8px;">8</div>
                        <div style="font-size: 0.95em; opacity: 0.95;">Major Overlap Areas Identified</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #1565c0 0%, #0d47a1 100%); color: white; padding: 20px; border-radius: 8px;">
                        <div style="font-size: 2em; font-weight: 700; margin-bottom: 8px;">~45%</div>
                        <div style="font-size: 0.95em; opacity: 0.95;">Average Effort Savings Across All Areas</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #f57c00 0%, #d84315 100%); color: white; padding: 20px; border-radius: 8px;">
                        <div style="font-size: 2em; font-weight: 700; margin-bottom: 8px;">1 System</div>
                        <div style="font-size: 0.95em; opacity: 0.95;">vs. 7+ Separate Systems = 50%+ Cost Reduction</div>
                    </div>
                </div>
            `;
            document.getElementById('overlapAnalysisContent').innerHTML = html;
        }

        // Initialize
        renderOverview();
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISO Control Set Analyzer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.95;
            margin-bottom: 20px;
        }

        .content {
            padding: 30px;
        }

        .standard-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            align-items: center;
        }

        .standard-btn {
            padding: 10px 18px;
            background: #f0f0f0;
            border: 2px solid #ddd;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 500;
            transition: all 0.3s ease;
            color: #333;
        }

        .standard-btn:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .standard-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
            border-bottom: 2px solid #e0e0e0;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 20px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            color: #666;
            transition: all 0.3s ease;
        }

        .tab-btn:hover {
            color: #667eea;
        }

        .tab-btn.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .standard-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .standard-card:hover {
            border-color: #667eea;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.15);
        }

        .standard-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .standard-title {
            font-size: 1.2em;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }

        .standard-type {
            color: #667eea;
            font-weight: 600;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .standard-description {
            color: #666;
            font-size: 0.95em;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }

        .stat-item {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
        }

        .stat-number {
            font-size: 1.5em;
            font-weight: 700;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.8em;
            color: #666;
            margin-top: 5px;
        }

        .expertise-box {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-top: 15px;
            border-radius: 4px;
        }

        .expertise-title {
            font-weight: 600;
            color: #667eea;
            margin-bottom: 8px;
        }

        .expertise-text {
            color: #555;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .overlap-highlight {
            background: #fffbea;
            border-left: 4px solid #f57c00;
            padding: 12px;
            margin-top: 10px;
            border-radius: 4px;
        }

        .overlap-title {
            font-weight: 600;
            color: #f57c00;
            margin-bottom: 5px;
        }

        .overlap-text {
            color: #666;
            font-size: 0.9em;
        }

        .footer {
            background: #f5f5f5;
            padding: 20px 30px;
            text-align: center;
            color: #666;
            font-size: 0.9em;
            border-top: 1px solid #ddd;
        }

        .section-title {
            font-size: 1.4em;
            font-weight: 700;
            color: #333;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #667eea;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .feature-item {
            background: #f9f9f9;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #667eea;
        }

        .feature-item strong {
            color: #333;
            display: block;
            margin-bottom: 5px;
        }

        .feature-item p {
            color: #666;
            font-size: 0.9em;
            margin: 0;
        }

        .loading {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }

        .error {
            background: #ffebee;
            border: 1px solid #f44336;
            color: #c62828;
            padding: 20px;
            border-radius: 6px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ISO Control Set Analyzer</h1>
            <p>Comprehensive analysis of normative requirements and controls across 9 ISO standards</p>
        </div>

        <div class="content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2 style="color: #333; margin: 0;">Select ISO Standard</h2>
                <div style="display: flex; gap: 10px;">
                    <button class="standard-btn" onclick="selectAllStandards()" style="background: #42a5f5; color: white; border-color: #42a5f5; font-weight: 600;">‚úì Select All</button>
                    <button class="standard-btn" onclick="clearSelection()" style="background: #ef5350; color: white; border-color: #ef5350; font-weight: 600;">‚úï Clear</button>
                </div>
            </div>

            <div class="standard-selector" id="standardButtons"></div>

            <!-- Tabs -->
            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('overview')">Overview</button>
                <button class="tab-btn" onclick="switchTab('comparison')">Comparison</button>
                <button class="tab-btn" onclick="switchTab('overlap')">Control Overlap</button>
            </div>

            <!-- Overview Tab -->
            <div id="overview" class="tab-content active">
                <div id="overviewContent" class="loading">Loading standards...</div>
            </div>

            <!-- Comparison Tab -->
            <div id="comparison" class="tab-content">
                <div id="comparisonContent"></div>
            </div>

            <!-- Overlap Tab -->
            <div id="overlap" class="tab-content">
                <div id="overlapContent"></div>
            </div>
        </div>

        <div class="footer">
            <p>ISO Control Set Analyzer | Powered by Melissa Witte-Spencer | December 2025</p>
        </div>
    </div>

    <script>
        let analyzerData = null;
    </script>
</body>
</html>
